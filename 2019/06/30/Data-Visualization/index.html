<p>&lt;!DOCTYPE html&gt;</p>
<html><br><head><meta name="generator" content="Hexo 3.8.0"><br>  <meta charset="utf-8"><br><script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.min.js"></script><br><script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script><br>  <meta name="viewport" content="width=device-width"><br>  <title>JS Bin</title><br><style id="jsbin-css"><br>.bar {<br>  fill: LightGrey;<br>  stroke: Black;<br>}<br><br>.bar:hover {<br>  fill: SteelBlue;<br>}<br><br>.axis–y path {<br>  display: none;<br>}<br><br>.axis–x–bottom path {<br>  display: none;<br>}<br><br>.zipcode {<br>  stroke: black;<br>  stroke-width: 1px;<br>  fill: none;<br>}<br><br>#caption {<br>  font-size: 10px;<br>}<br></style><br></head><br><body><br>  <div id="chart"><br>      <svg width="1000" height="1000"/><br>  </div><br><script id="jsbin-javascript"><br>var ZIPCODE_URL = “<a href="https://raw.githubusercontent.com/hvo/datasets/master/nyc_zip.geojson&quot;">https://raw.githubusercontent.com/hvo/datasets/master/nyc_zip.geojson&quot;</a>;<br>var RES_BY_CUISINE_URL = “<a href="https://raw.githubusercontent.com/hvo/datasets/master/nyc_restaurants_by_cuisine.json&quot;">https://raw.githubusercontent.com/hvo/datasets/master/nyc_restaurants_by_cuisine.json&quot;</a>;<br><br>Promise.all([d3.json(ZIPCODE_URL),<br>             d3.json(RES_BY_CUISINE_URL)]).then(createChart);<br><br>function createChart(allData) {<br>  let zipcodes = allData[0],<br>      byCuisine = allData[1]<br>                  .sort(item =&gt; item[1]).slice(0, 25),<br>      svg        = d3.select(“svg”),<br>      gMap       = svg.append(“g”),<br>      canvasSize = [1000, 1000],<br><br>      projection = d3.geoMercator()<br>                     .scale(Math.pow(2, 10.16 + 5.34))<br>                     .center([-73.975, 40.7])<br>                     .translate([680, 240]),<br><br>      path       = d3.geoPath().projection(projection);<br><br>  var x = d3.scaleLinear()<br>    .domain([0, byCuisine[0].total])<br>    .rangeRound([0, 250]);<br><br>  var y = d3.scaleBand()<br>    .domain(byCuisine.map(d =&gt; d.cuisine))<br>    .rangeRound([10, 450]);<br><br>  gMap.append(“g”)<br>    .attr(“class”, “axis axis–y”)<br>    .attr(“transform”, “translate(150, 0)”)<br>    .call(d3.axisLeft(y))<br><br>  gMap.append(“g”)<br>    .attr(“class”, “axis axis–x–top”)<br>    .attr(“transform”, “translate(155, 20)”)<br>    .call(d3.axisTop(x).ticks(5))<br><br>  gMap.append(“g”)<br>    .attr(“class”, “axis axis–x–bottom”)<br>    .attr(“transform”, “translate(155, 445)”)<br>    .call(d3.axisBottom(x).ticks(5))<br><br>  gMap.append(‘line’)<br>    .attr(‘stroke’, ‘gray’)<br>    .attr(‘x1’, 155)<br>    .attr(‘y1’, 14)<br>    .attr(‘x2’, 155)<br>    .attr(‘y2’, 445)<br>    .style(“opacity”, 0.2);<br><br>  gMap.append(‘line’)<br>    .attr(‘stroke’, ‘gray’)<br>    .attr(‘x1’, 215)<br>    .attr(‘y1’, 14)<br>    .attr(‘x2’, 215)<br>    .attr(‘y2’, 445)<br>    .style(“opacity”, 0.2);<br><br>  gMap.append(‘line’)<br>    .attr(‘stroke’, ‘gray’)<br>    .attr(‘x1’, 274)<br>    .attr(‘y1’, 14)<br>    .attr(‘x2’, 274)<br>    .attr(‘y2’, 445)<br>    .style(“opacity”, 0.2);<br><br>  gMap.append(‘line’)<br>    .attr(‘stroke’, ‘gray’)<br>    .attr(‘x1’, 332)<br>    .attr(‘y1’, 14)<br>    .attr(‘x2’, 332)<br>    .attr(‘y2’, 445)<br>    .style(“opacity”, 0.2);<br><br>  gMap.append(‘line’)<br>    .attr(‘stroke’, ‘gray’)<br>    .attr(‘x1’, 391)<br>    .attr(‘y1’, 14)<br>    .attr(‘x2’, 391)<br>    .attr(‘y2’, 445)<br>    .style(“opacity”, 0.2);<br><br>  gMap.append(“text”)<br>    .attr(‘x’, 225)<br>    .attr(‘y’, 475)<br>    .text(“Number of Restaurants”)<br>    .attr(“font-size”, “10px”);<br><br>  gMap.selectAll(“.bar”)<br>    .data(byCuisine)<br>    .enter().append(“rect”)<br>    .attr(“class”, “bar”)<br>    .attr(“x”, 155)<br>    .attr(“y”, (d, i) =&gt; y(d.cuisine))<br>    .attr(“width”, (d, i) =&gt; x(d.total))<br>    .attr(“height”, y.bandwidth() - 2)<br>    .on(“mouseover”, function (d) {<br>    d3.select(this)<br>      .transition().ease(d3.easeBounce).duration(300)<br>      .attr(‘x’, 155 - 10)<br>      .attr(‘y’, y(d.cuisine) - 2)<br>      .attr(‘width’, x(d.total) + 20)<br>      .attr(‘height’, y.bandwidth() + 2);<br><br>    var counts = d.perZip,<br>        data     = Object.entries(counts),      // convert counts to a list<br>        maxCount = d3.max(data, d =&gt; d[1]),     // get the max count<br>        color    = d3.scaleThreshold()          // then create a scale with 5 periods<br>                     .domain(d3.range(0, maxCount, maxCount/5))<br>                     .range(d3.schemeBlues[5]),<br>        tickrange = d3.scaleLinear().domain([0, 4]),<br>        ticks = d3.scaleLinear()<br>                  .domain([0, maxCount/1000])<br>                  .range([345, 500]);<br><br>    gMap.selectAll(“.zipcode”)<br>        .data(data, myKey) // we must join data and visual elements using the right keys<br>        .transition().duration(250)<br>        .style(“fill”, d =&gt; color(d[1]));<br><br>    gMap.append(“text”)<br>        .attr(“id”, “caption”)<br>        .attr(“x”, 440)<br>        .attr(“y”, 30)<br>        .attr(“font-weight”, “bold”)<br>        .text(“Number of “ + d.cuisine + “ Restaurants”)<br><br>    gMap.append(“rect”)<br>      .attr(“id”, “legend_bar1”)<br>      .attr(“width”, 39)<br>      .attr(“height”, 6)<br>      .style(“fill”, d3.schemeBlues[5][1])<br>      .attr(“transform”, “translate(441, 35)”);<br><br>    gMap.append(“rect”)<br>      .attr(“id”, “legend_bar2”)<br>      .attr(“width”, 39)<br>      .attr(“height”, 6)<br>      .style(“fill”, d3.schemeBlues[5][2])<br>      .attr(“transform”, “translate(480, 35)”);<br><br>    gMap.append(“rect”)<br>      .attr(“id”, “legend_bar3”)<br>      .attr(“width”, 39)<br>      .attr(“height”, 6)<br>      .style(“fill”, d3.schemeBlues[5][3])<br>      .attr(“transform”, “translate(519, 35)”);<br><br>    gMap.append(“rect”)<br>      .attr(“id”, “legend_bar4”)<br>      .attr(“width”, 39)<br>      .attr(“height”, 6)<br>      .style(“fill”, d3.schemeBlues[5][4])<br>      .attr(“transform”, “translate(558, 35)”);<br><br>    gMap.append(“g”)<br>        .attr(“transform”, “translate(96, 35)”)<br>        .attr(“id”, “tick”)<br>        .call(d3.axisBottom(ticks)<br>        .tickSize(10)<br>        .tickFormat(function(tickrange, i){<br>           return (Math.round(8.0<em>tickrange)/10).toFixed(1)+”k”;<br>        })<br>        .tickValues([0.00</em>maxCount/1000,<br>                     0.25<em>maxCount/1000,<br>                     0.50</em>maxCount/1000,<br>                     0.75<em>maxCount/1000,<br>                     1.00</em>maxCount/1000]))<br>        .select(“.domain”)<br>        .remove();<br><br>  })<br>    .on(“mouseout”, function (d) {<br>    d3.select(this)<br>      .transition().duration(250)<br>      .attr(‘x’, 155)<br>      .attr(‘y’, y(d.cuisine))<br>      .attr(‘width’, x(d.total))<br>      .attr(‘height’, y.bandwidth() - 2);<br><br>    gMap.selectAll(“.zipcode”)<br>        .transition().duration(250)<br>        .style(“fill”, “white”);<br>    gMap.select(“#caption”).remove();<br>    gMap.select(“#tick”).remove();<br>    gMap.select(“#legend_bar1”).remove();<br>    gMap.select(“#legend_bar2”).remove();<br>    gMap.select(“#legend_bar3”).remove();<br>    gMap.select(“#legend_bar4”).remove();<br>  })<br><br>  // Let’s create a path for each (new) zipcode shape<br>  gMap.selectAll(“.zipcode”).data(zipcodes.features)<br>      .enter().append(“path”)<br>      .attr(“class”, “zipcode”)<br>      .attr(“d”, path);<br>}<br><br>function myKey(d) {<br>  return (d[0]?d[0]:d.properties.zipcode);<br>}<br></script><br><br><br><script id="jsbin-source-css" type="text/css">.bar {<br>  fill: LightGrey;<br>  stroke: Black;<br>}<br><br>.bar:hover {<br>  fill: SteelBlue;<br>}<br><br>.axis–y path {<br>  display: none;<br>}<br><br>.axis–x–bottom path {<br>  display: none;<br>}<br><br>.zipcode {<br>  stroke: black;<br>  stroke-width: 1px;<br>  fill: none;<br>}<br><br>#caption {<br>  font-size: 10px;<br>}</script><br><br></body><br></html>
